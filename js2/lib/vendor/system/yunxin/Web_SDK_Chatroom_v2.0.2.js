!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Chatroom=t():e.Chatroom=t()}(this,function(){return webpackJsonp_NIM_Web_SDK_v2_0_2([0],[function(e,t,o){o(1),o(2),o(3).polyfill();var r=o(8);r.platform=o(25),r.xhr=o(69),r.io=o(44),r.naturalSort=o(11),r.deepAccess=o(12),r.db=o(77),r.util=o(10),r.support=o(78),r.blob=o(39),e.exports=r},,,,,,,,function(e,t,o){function r(e){var t=this;e.Protocol=s,e.Message=c,e.constructor=r,t.init(e);var o=t.protocol;o.api=t}var a=o(9),s=o(40),n=o(28),m=o(24),c=o(60);r.setDebug=function(e){m.setDebug(e)};var i=r.fn=r.prototype=Object.create(a.prototype);r.protocols={},r.info=i.info=n.info,i.getChatroom=function(e){var t=this;t.processCallback(e),t.sendCmd("getChatroom",e)},i.closeChatroom=function(e){var t=this;t.processCustom(e),t.processCallback(e),t.sendCmd("closeChatroom",e)},e.exports=r,o(67),o(68)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,o){function r(e){var t=this;s.verifyOptions(e,"appKey account token chatroomId chatroomAddresses"),s.verifyParamType("chatroomAddresses",e.chatroomAddresses,"array"),s.verifyCallback(e,"onconnect onerror onwillreconnect ondisconnect onmsg"),a.call(t,e),t.name="Chatroom"}var a=o(41),s=o(10),n=o(28),m=o(49),c=o(50),i=o(52),p=o(53),u=m.getInstance({type:"Chatroom",configMap:c,serializeMap:i,unserializeMap:p}),d=o(54),h=o(55),l=r.fn=r.prototype=Object.create(a.prototype);l.init=function(){var e=this;e.socketUrls=e.options.chatroomAddresses.map(n.formatSocketUrl),e.socketUrlsBackup=e.socketUrls.slice(0),e.parser=u,e.syncResult={},e.timetags={}},l.processResponse=function(e){var t=this;switch(e.service){case"chatroom":t.processChatroom(e)}},l.processChatroom=function(e){var t=this;switch(e.cmd){case"login":e.error||(e.obj={chatroom:d.reverse(e.content.chatroom),member:h.reverse(e.content.chatroomMember)});break;case"kicked":t.onKicked(e);break;case"logout":break;case"sendMsg":t.onSendMsg(e);break;case"msg":t.onMsg(e);break;case"getChatroomMembers":t.onChatroomMembers(e);break;case"getHistoryMsgs":t.onHistoryMsgs(e);break;case"markChatroomMember":t.onMarkChatroomMember(e);break;case"closeChatroom":break;case"getChatroom":t.onChatroom(e);break;case"getChatroomMembersInfo":t.onChatroomMembersInfo(e);break;case"kickChatroomMember":}},l.onChatroom=function(e){e.error||(e.obj.chatroom=d.reverse(e.content.chatroom))},e.exports=r,o(56),o(57),o(58),o(59)},,,,,,,,,,function(e,t,o){var r=o(10),a=o(51),s=r.merge({},a.idMap,{chatroom:{id:13,login:2,kicked:3,logout:4,sendMsg:6,msg:7,getChatroomMembers:8,getHistoryMsgs:9,markChatroomMember:11,closeChatroom:12,getChatroom:13,getChatroomMembersInfo:16,kickChatroomMember:17}}),n=r.merge({},a.cmdConfig,{login:{sid:s.chatroom.id,cid:s.chatroom.login,params:[{type:"byte",name:"type"},{type:"Property",name:"login"},{type:"Property",name:"imLogin"}]},logout:{sid:s.chatroom.id,cid:s.chatroom.logout},sendMsg:{sid:s.chatroom.id,cid:s.chatroom.sendMsg,params:[{type:"Property",name:"msg"}]},getChatroomMembers:{sid:s.chatroom.id,cid:s.chatroom.getChatroomMembers,params:[{type:"byte",name:"type"},{type:"long",name:"time"},{type:"int",name:"limit"}]},getHistoryMsgs:{sid:s.chatroom.id,cid:s.chatroom.getHistoryMsgs,params:[{type:"long",name:"timetag"},{type:"int",name:"limit"}]},markChatroomMember:{sid:s.chatroom.id,cid:s.chatroom.markChatroomMember,params:[{type:"string",name:"account"},{type:"int",name:"type"},{type:"bool",name:"isAdd"},{type:"int",name:"level"},{type:"string",name:"custom"}]},closeChatroom:{sid:s.chatroom.id,cid:s.chatroom.closeChatroom,params:[{type:"string",name:"custom"}]},getChatroom:{sid:s.chatroom.id,cid:s.chatroom.getChatroom},getChatroomMembersInfo:{sid:s.chatroom.id,cid:s.chatroom.getChatroomMembersInfo,params:[{type:"StrArray",name:"accounts"}]},kickChatroomMember:{sid:s.chatroom.id,cid:s.chatroom.kickChatroomMember,params:[{type:"string",name:"account"},{type:"string",name:"custom"}]}}),m="chatroom",c=r.merge({},a.packetConfig,{"4_10":{service:"notify"},"4_11":{service:"notify"},"13_2":{service:m,cmd:"login",response:[{type:"Property",name:"chatroom"},{type:"Property",name:"chatroomMember"}]},"13_3":{service:m,cmd:"kicked",response:[{type:"Number",name:"reason"},{type:"String",name:"custom"}]},"13_4":{service:m,cmd:"logout"},"13_6":{service:m,cmd:"sendMsg",response:[{type:"Property",name:"msg"}]},"13_7":{service:m,cmd:"msg",response:[{type:"Property",name:"msg"}]},"13_8":{service:m,cmd:"getChatroomMembers",response:[{type:"PropertyArray",name:"members",entity:"chatroomMember"}]},"13_9":{service:m,cmd:"getHistoryMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"13_11":{service:m,cmd:"markChatroomMember",response:[{type:"Property",name:"chatroomMember"}]},"13_12":{service:m,cmd:"closeChatroom"},"13_13":{service:m,cmd:"getChatroom",response:[{type:"Property",name:"chatroom"}]},"13_16":{service:m,cmd:"getChatroomMembersInfo",response:[{type:"PropertyArray",name:"members",entity:"chatroomMember"}]},"13_17":{service:m,cmd:"kickChatroomMember"}});e.exports={idMap:s,cmdConfig:n,packetConfig:c}},,function(e,t){e.exports={imLogin:{os:4,sdkVersion:6,protocolVersion:9,deviceId:13,appKey:18,account:19,browser:24,session:26,token:1e3},login:{appKey:1,account:2,deviceId:3,chatroomId:5,chatroomNick:20,chatroomAvatar:21,chatroomCustom:22,chatroomEnterCustom:23},chatroom:{id:1,name:3,announcement:4,broadcastUrl:5,custom:12,createTime:14,updateTime:15,creator:100,onlineMemberNum:101},msg:{idClient:1,type:2,attach:3,custom:4,resend:5,userUpdateTime:6,fromNick:7,fromAvatar:8,fromCustom:9,time:20,from:21,chatroomId:22,fromClientType:23},chatroomMember:{chatroomId:1,account:2,type:3,level:4,nick:5,avatar:6,custom:7,online:8,guest:9,enterTime:10,blacked:12,gaged:13,valid:14,updateTime:15}}},function(e,t){e.exports={imLogin:{4:"os",6:"sdkVersion",9:"protocolVersion",13:"deviceId",18:"appKey",19:"account",24:"browser",26:"session",1000:"token"},login:{1:"appKey",2:"account",3:"deviceId",5:"chatroomId",20:"chatroomNick",21:"chatroomAvatar",22:"chatroomCustom",23:"chatroomEnterCustom"},chatroom:{1:"id",3:"name",4:"announcement",5:"broadcastUrl",12:"custom",14:"createTime",15:"updateTime",100:"creator",101:"onlineMemberNum"},msg:{1:"idClient",2:"type",3:"attach",4:"custom",5:"resend",6:"userUpdateTime",7:"fromNick",8:"fromAvatar",9:"fromCustom",20:"time",21:"from",22:"chatroomId",23:"fromClientType"},chatroomMember:{1:"chatroomId",2:"account",3:"type",4:"level",5:"nick",6:"avatar",7:"custom",8:"online",9:"guest",10:"enterTime",12:"blacked",13:"gaged",14:"valid",15:"updateTime"}}},function(e,t,o){function r(){}var a=o(10),s=a.notundef;r.reverse=function(e){var t=a.copy(e);return s(t.createTime)&&(t.createTime=+t.createTime),s(t.updateTime)&&(t.updateTime=+t.updateTime),s(t.onlineMemberNum)&&(t.onlineMemberNum=+t.onlineMemberNum),t},e.exports=r},function(e,t,o){function r(){}var a=o(10),s=a.notundef,n={"-1":"restricted",0:"common",1:"owner",2:"manager"};r.reverse=function(e){var t=a.copy(e);return s(t.chatroomId)&&(t.chatroomId=""+t.chatroomId),s(t.type)&&(t.type=n[t.type]),s(t.level)&&(t.level=+t.level),s(t.online)&&(t.online=1===+t.online),s(t.enterTime)&&(t.enterTime=+t.enterTime),s(t.guest)&&(t.guest=1===+t.guest),s(t.blacked)&&(t.blacked=1===+t.blacked),s(t.gaged)&&(t.gaged=1===+t.gaged),s(t.valid)&&(t.valid=1===+t.valid),s(t.updateTime)&&(t.updateTime=+t.updateTime),t.online||delete t.enterTime,t.guest&&(t.type="guest",delete t.valid),"common"!==t.type&&delete t.level,delete t.guest,t},r.reverseMembers=function(e){return e.map(function(e){return r.reverse(e)})},r.validTypes=Object.keys(n),e.exports=r},function(e,t,o){var r=o(40).fn;r.refreshSocketUrl=function(){var e=this;e.socketUrls=e.socketUrlsBackup.slice(0),e.connectToUrl(e.getNextSocketUrl())}},function(e,t,o){var r=o(40).fn,a=o(47),s=o(10);r.assembleLogin=function(){var e=this,t=e.options,o={appKey:t.appKey,account:t.account,deviceId:a.deviceId,chatroomId:t.chatroomId};return o=s.merge(o,s.filterObj(t,"chatroomNick chatroomAvatar chatroomCustom chatroomEnterCustom")),{type:1,login:o,imLogin:e.assembleIMLogin()}},r.afterLogin=function(e){var t=this,o=e.chatroom;t.chatroom=o,t.api.info=o},r.kickedReasons=["","chatroomClosed","managerKick","samePlatformKick","illegalState","blacked"],r.kickedMessages=["","聊天室关闭了","被房主或者管理员踢出","不允许同一个帐号在多个地方同时登录","状态异常","被拉黑了"]},function(e,t,o){var r=o(40).fn,a=o(10);r.completeMsg=function(e){var t=this;e.chatroomId=t.chatroom.id,e.from=t.options.account,e.fromClientType="Web",e.time||(e.time=+new Date)},r.onMsg=function(e){var t=this,o=t.message.reverse(e.content.msg);t.checkMsgUnique(o)&&t.options.onmsg(o)},r.checkMsgUnique=a.genCheckUniqueFunc("idClient"),r.onSendMsg=function(e){var t=e.obj.msg;e.error?t.status="fail":(t=e.content.msg,t.status="success"),t=this.message.reverse(t),e.obj=t},r.onHistoryMsgs=function(e){e.error||(e.obj.msgs=this.message.reverseMsgs(e.content.msgs))}},function(e,t,o){var r=o(40).fn,a=o(55);r.onChatroomMembersInfo=r.onChatroomMembers=function(e){e.error||(e.obj.members=a.reverseMembers(e.content.members))},r.onMarkChatroomMember=function(e){e.error||(e.obj.member=a.reverse(e.content.chatroomMember))}},function(e,t,o){var r=function(e){this.account=e.account},a=r.prototype,s=a.Message=o(61),n=a.TextMessage=o(63),m=a.FileMessage=o(64),c=a.NotificationMessage=o(65),i=a.CustomMessage=o(66);a.reverse=function(e){var t,o=s.getType(e);switch(o){case"text":t=n.reverse(e);break;case"image":case"audio":case"video":case"file":t=m.reverse(e);break;case"notification":t=c.reverse(e);break;case"custom":t=i.reverse(e)}return s.setExtra(t,this.account),t},a.reverseMsgs=function(e){var t=this;return e.map(function(e){return t.reverse(e)})},e.exports=r},function(e,t,o){function r(e){var t=this;e.resend?(a.verifyOptions(e,"idClient"),t.idClient=e.idClient):t.idClient=a.guid(),t.type=c[e.type],t.resend=e.resend?1:0,s(e.custom)&&(t.custom=""+e.custom)}var a=o(10),s=a.notundef,n=o(46),m=o(62),c=m.typeMap;r.validTypes=m.validTypes,r.getType=m.getType,r.reverse=function(e){var t=a.filterObj(e,"chatroomId idClient from fromNick fromAvatar fromCustom userUpdateTime custom status");return t=a.merge(t,{fromClientType:n.reverseType(e.fromClientType),type:r.getType(e),time:+e.time,resend:1===+e.resend}),s(t.userUpdateTime)&&(t.userUpdateTime=+t.userUpdateTime),t.status=t.status||"success",t},r.setExtra=function(e,t){m.setFlow(e,t)},e.exports=r},,function(e,t,o){function r(e){s.verifyOptions(e,"text"),e.type="text",a.call(this,e),this.attach=e.text}var a=o(61),s=o(10);r.prototype=Object.create(a.prototype),r.reverse=function(e){var t=a.reverse(e);return t.text=e.attach,t},e.exports=r},function(e,t){},function(e,t,o){function r(){}var a=o(10),s=a.notundef,n=o(61),m={301:"memberEnter",302:"memberExit",303:"blackMember",304:"unblackMember",305:"gagMember",306:"ungagMember",307:"addManager",308:"removeManager",309:"addCommon",310:"removeCommon",311:"closeChatroom",312:"updateChatroom",313:"kickMember"};r.prototype=Object.create(n.prototype),r.reverse=function(e){var t=n.reverse(e);if(e.attach=e.attach?""+e.attach:"",e.attach){var o=JSON.parse(e.attach);if(t.attach={type:m[o.id]},s(o.data)){var r=o.data;s(r.operator)&&(t.attach.from=r.operator),s(r.opeNick)&&(t.attach.fromNick=r.opeNick),s(r.target)&&(t.attach.to=r.target),s(r.tarNick)&&(t.attach.toNick=r.tarNick),s(r.ext)&&(t.attach.custom=r.ext)}}else t.attach={};return t},e.exports=r},function(e,t,o){function r(e){s.verifyOptions(e,"content"),a.call(this,e),this.attach=e.content}var a=o(61),s=o(10);r.prototype=Object.create(a.prototype),r.reverse=function(e){var t=a.reverse(e);return t.content=e.attach,t},e.exports=r},function(e,t,o){var r=o(10),a=r.undef,s=o(8).fn;s.beforeSendMsg=function(e){e.cmd="sendMsg"},s.getHistoryMsgs=function(e){r.verifyOptions(e),a(e.timetag)?e.timetag=0:r.verifyParamType("timetag",e.timetag,"number"),a(e.limit)?e.limit=100:r.verifyParamType("limit",e.limit,"number");var t=this;t.processCallback(e),t.sendCmd("getHistoryMsgs",e,e.callback)}},function(e,t,o){var r=o(10),a=r.undef,s=r.verifyOptions,n=r.verifyParamType,m=o(8).fn;m.getChatroomMembers=function(e){var t=this;s(e,"guest"),n("guest",e.guest,"boolean"),a(e.time)?e.time=0:n("time",e.time,"number"),a(e.limit)?e.limit=100:n("limit",e.limit,"number"),t.processCallback(e),e.type=e.guest?1:0,!e.guest&&e.onlyOnline&&(e.type=2),t.sendCmd("getChatroomMembers",e)},m.getChatroomMembersInfo=function(e){var t=this;s(e,"accounts"),n("accounts",e.accounts,"array"),t.processCallback(e),t.sendCmd("getChatroomMembersInfo",e)},m.markChatroomManager=function(e){e.type=1,this.markChatroomMember(e)},m.markChatroomCommonMember=function(e){e.type=2,this.markChatroomMember(e)},m.markChatroomBlacklist=function(e){e.type=-1,this.markChatroomMember(e)},m.markChatroomGaglist=function(e){e.type=-2,this.markChatroomMember(e)},m.markChatroomMember=function(e){s(e,"account type isAdd"),n("isAdd",e.isAdd,"boolean"),a(e.level)?e.level=0:n("level",e.level,"number");var t=this;t.processCustom(e),t.processCallback(e),t.sendCmd("markChatroomMember",e)},m.kickChatroomMember=function(e){var t=this;s(e,"account"),t.processCustom(e),t.processCallback(e),t.sendCmd("kickChatroomMember",e)}}])});